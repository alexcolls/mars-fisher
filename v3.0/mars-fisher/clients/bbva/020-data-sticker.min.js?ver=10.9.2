var idEnvio,adobeDataPosJsonLayers=[],autoScrollDisabled=!1,scrollDataStickerEnabled=!0;function isInAdobeDatalayers(a,t,e){var o,i=!1;void 0!==adobeDataJsonLayers[t]&&(adobeDataLayer=adobeDataJsonLayers[t],o=adobePosConcat,adobePosConcat=adobeDataPosJsonLayers.indexOf(t)+1,flagBack=o>adobePosConcat?"B":"","function"==typeof digitalView&&(dbg.log("actualizarDigitalData anterior",e),actualizarDigitalData("",""),digitalView("Page View",digitalData)),i=!0),i||(adobePosConcat=Object.keys(adobeDataJsonLayers).length,flagBack="",void 0===adobeDataJsonLayers[t]&&(o=adobeDataLayer,adobeDataJsonLayers[t]=o,adobeDataPosJsonLayers.push(t)),"function"==typeof digitalView&&(dbg.log("actualizarDigitalData siguiente",e),actualizarDigitalData("",""),digitalView("Page View",digitalData)))}function isInDatalayer(t,a){var e,o=!1;a+=" | BBVA",void 0!==window.ga&&(e=dataLayer.find(a=>isSinglePost(t,a)))&&window.ga.getAll()[0]&&(window.ga.getAll()[0].set({page:e.PostURL,title:e.postTitle+" | BBVA"}),window.ga.getAll()[0].send("pageview"),dataLayer.push(e),o=!0),o||void 0!==window.ga&&(window.ga.getAll()[0].set({page:t,title:a}),window.ga.getAll()[0].send("pageview"),dataLayer.push(dataLayerObject))}function isSinglePost(a,t){return!(!t.PostURL||t.PostURL!==a)}jQuery(document).ready(function(){var r=[];function l(a,t,e){dbg.log("sendDataLayers: "+e),r.lastIndexOf(a)<r.length-1&&("undefined"!=typeof OnetrustActiveGroups&&-1!==OnetrustActiveGroups.indexOf("C0002")&&(isInDatalayer(t,e),isInAdobeDatalayers("",t,e)),r.push(a))}"scrollRestoration"in history&&(history.scrollRestoration="manual"),window.onpopstate=function(a){if(a.state,a.state.page,autoScrollDisabled)autoScrollDisabled&&(autoScrollDisabled=!1,e=a.state.page-1,jQuery("*[data-sticker]").length>=e)&&(t=jQuery(jQuery("*[data-sticker]")[e]).attr("data-sticker"),jQuery("title").text(t),l(jQuery(jQuery("*[data-sticker]")[e]).attr("data-sticker-link"),a.state.url,t));else{var t,e=a.state.page-1;if(jQuery("*[data-sticker]").length>=e){const o=jQuery(jQuery("*[data-sticker]")[e]).attr("data-sticker"),i=jQuery(jQuery("*[data-sticker]")[e]).attr("data-sticker-link"),r=i.replace(cb_options.site_url,"");r===a.state.url?(scrollDataStickerEnabled=!1,t=Math.floor(jQuery(jQuery("*[data-sticker]")[e]).offset().top),jQuery("html").animate({scrollTop:t},450,"swing",()=>{scrollDataStickerEnabled=!0,jQuery("title").text(o),l(i,r,o)})):location.reload()}}},jQuery(window).scroll(jQuery.debounce(defaultDebounce,function(){var o=jQuery(window).scrollTop(),i=0;jQuery("*[data-sticker]").each(function(){i++;var a=jQuery(this),t=1===i?0:Math.floor(a.offset().top),e=Math.floor(t+a.height());t<=o&&o<e&&(data.postTitle=adobeDataLayer.postTitleAdobe,data.urlDownload=window.location.href,jQuery(".gallery-introduction .introduction-footer").addClass("hidden"),a.find(".gallery-introduction .introduction-footer").removeClass("hidden"),(t=a.attr("data-sticker"))!=(e=jQuery(".article-title-container div")).attr("data-active-title"))&&(dbg.log("Actualizando sticker: "+t),e.attr("data-active-title",t),e.html(t),a=(e=a.attr("data-sticker-link")).replace(cb_options.site_url,""),e)&&(0==r.length&&(r.push(e),dbg.log("History init: ",[i,e]),history.replaceState({page:i,url:a},"")),-1===r.indexOf(e)?(dbg.log("History push: ",[i,e]),history.pushState({page:i,url:a},"",e),jQuery("title").text(t),l(e,a,t)):history.state.page!==i&&scrollDataStickerEnabled&&(e=i-history.state.page,autoScrollDisabled=!0,dbg.log("History go: ",e),history.go(e)))})}))});
